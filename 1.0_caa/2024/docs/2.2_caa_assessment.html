<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2025-01-30" />

<title>Catch-at-age: assessment plots</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Mackerel CAA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="0.0_settings.html">
    <span class="fa fa-cogs"></span>
     
  </a>
</li>
<li>
  <a href="1.0_read.html">Data</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    CAA
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="2.0_caa.html">Calculation</a>
    </li>
    <li>
      <a href="2.1_caa_comparison.html">Comparison</a>
    </li>
    <li>
      <a href="2.2_caa_assessment.html">Assessment</a>
    </li>
    <li>
      <a href="2.3_caa_region.html">Regional</a>
    </li>
    <li>
      <a href="2.4_caa_gear.html">Gear</a>
    </li>
    <li>
      <a href="2.5_caa_period.html">Period</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    S52 licence
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="3.4_S52_LF_supptable.html">S52 licence - Length frequency</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Catch-at-age: assessment plots</h1>
<h4 class="date">2025-01-30</h4>

</div>


<div id="set-up" class="section level1" number="1">
<h1><span class="header-section-number">1</span> SET-UP</h1>
<div id="settings" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> settings</h2>
<pre class="r"><code>source(&#39;0.0_settings.R&#39;)</code></pre>
</div>
<div id="load-all-data" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> load all data</h2>
<pre class="r"><code>load(paste0(dir.rdat, &quot;caa.Rdata&quot;))
load(paste0(dir.rdat, &quot;catch.caa.Rdata&quot;))
load(paste0(dir.rdat, &quot;lf.caa.Rdata&quot;))
load(paste0(dir.rdat, &quot;bio.caa.Rdata&quot;))</code></pre>
</div>
</div>
<div id="input-data-plot" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Input data plot</h1>
<pre class="r"><code>bio.caa$id &lt;- with(bio.caa,paste(sample.id,year,period,region,gear),collapse=&#39;.&#39;)
bio.in &lt;- ddply(bio.caa,c(&#39;year&#39;,&#39;period&#39;,&#39;region&#39;,&#39;gear&#39;),summarise,n=length(id),N=length(unique(id)))
bio.in$input &lt;- &#39;bio&#39;

lf.caa$id &lt;- with(lf.caa,paste(sample.id,year,period,region,gear),collapse=&#39;.&#39;)
lf.in &lt;- ddply(lf.caa,c(&#39;year&#39;,&#39;period&#39;,&#39;region&#39;,&#39;gear&#39;),summarise,n=length(id),N=length(unique(id)))
lf.in$input &lt;- &#39;lf&#39;

names(catch.caa)[5] &lt;- &#39;N&#39;
catch.caa$input &lt;- &#39;catch&#39;

cols &lt;- c(&quot;year&quot;,&quot;period&quot;,&quot;region&quot;,&quot;gear&quot;,&quot;N&quot;,&quot;input&quot;)
all &lt;- rbind(catch.caa[,cols],lf.in[,cols],bio.in[,cols])
all$input &lt;- factor(all$input,levels=c(&quot;catch&quot;,&quot;lf&quot;,&quot;bio&quot;))


fnames &lt;- as_labeller(c(`catch` = &quot;Débarquement / Landings (t)&quot;, `lf` = &quot;Échantillons de fréquence de longueur (nombre) / Length-frequency samples (number)&quot;,`bio` = &quot;Biologique (nombre de poissons) / Biological (number of fish)&quot;))

p1 &lt;- ggplot(all,aes(x=year,y=N,fill=gear))+
    geom_bar(stat=&#39;identity&#39;)+
    facet_wrap(input~.,scale=&#39;free_y&#39;,ncol=1,labeller = fnames)+
    scale_y_continuous(expand = c(0,0))+
    scale_x_continuous(expand = c(0,0), limits=c(1975,tail(my.year,1)+1))+
    scale_fill_viridis_d(na.value = &quot;grey50&quot;)+
    theme(legend.position = &#39;top&#39;)+
    labs(x=&#39;Année/Year&#39;,y=&#39;&#39;,fill=&#39;Enging / Gear&#39;)
ggsave(paste0(&quot;../../img/&quot;, tail(my.year,1),&quot;/Samples_gear.png&quot;), width=8, height=6, dpi=600, units=&quot;in&quot;)
## Warning: Removed 411 rows containing missing values or values outside the scale range (`geom_bar()`).

p2 &lt;- ggplot(all,aes(x=year,y=N,fill=as.factor(period)))+
    geom_bar(stat=&#39;identity&#39;)+
    facet_wrap(input~.,scale=&#39;free_y&#39;,ncol=1,labeller = fnames)+
    scale_y_continuous(expand = c(0,0))+
    scale_x_continuous(expand = c(0,0), limits=c(1975,tail(my.year,1)+1))+
    scale_fill_viridis_d(na.value = &quot;grey50&quot;)+
    theme(legend.position = &#39;top&#39;)+
    labs(x=&#39;Année/Year&#39;,y=&#39;&#39;,fill=&#39;Période / Period&#39;)
ggsave(paste0(&quot;../../img/&quot;, tail(my.year,1),&quot;/Samples_period.png&quot;), width=8, height=6, dpi=600, units=&quot;in&quot;)
## Warning: Removed 411 rows containing missing values or values outside the scale range (`geom_bar()`).

p3 &lt;- ggplot(all,aes(x=year,y=N,fill=region))+
    geom_bar(stat=&#39;identity&#39;)+
    facet_wrap(input~.,scale=&#39;free_y&#39;,ncol=1,labeller = fnames)+
    scale_y_continuous(expand = c(0,0))+
    scale_x_continuous(expand = c(0,0), limits=c(1975,tail(my.year,1)+1))+
    scale_fill_viridis_d(na.value = &quot;grey50&quot;)+
    theme(legend.position = &#39;top&#39;)+
    labs(x=&#39;Année/Year&#39;,y=&#39;&#39;,fill=&#39;Région / Region&#39;)
ggsave(paste0(&quot;../../img/&quot;, tail(my.year,1),&quot;/Samples_region.png&quot;), width=8, height=6, dpi=600, units=&quot;in&quot;)
## Warning: Removed 411 rows containing missing values or values outside the scale range (`geom_bar()`).

grid.arrange(p1,p2,p3,ncol=3)
## Warning: Removed 411 rows containing missing values or values outside the scale range (`geom_bar()`).
## Removed 411 rows containing missing values or values outside the scale range (`geom_bar()`).
## Removed 411 rows containing missing values or values outside the scale range (`geom_bar()`).</code></pre>
<p><img src="2.2_caa_assessment_files/figure-html/plot_input-1.png" width="1920" style="display: block; margin: auto;" /></p>
<pre class="r"><code>


sample_export &lt;- rbind(lf.in[,cols],bio.in[,cols])
sample_export$input &lt;- factor(sample_export$input,levels=c(&quot;lf&quot;,&quot;bio&quot;))
fnamesexport &lt;- as_labeller(c(`lf` = &quot;Length-frequency samples (number)&quot;,`bio` = &quot;Biological (number)&quot;))
p3ex &lt;- ggplot(sample_export,aes(x=year,y=N,fill=region))+
    geom_bar(stat=&#39;identity&#39;)+
    facet_wrap(input~.,scale=&#39;free_y&#39;,ncol=1,labeller = fnames)+
    scale_y_continuous(expand = c(0,0))+
    scale_x_continuous(expand = c(0,0), limits=c(1975,tail(my.year,1)+1))+
    scale_fill_viridis_d(na.value = &quot;grey50&quot;)+
    theme(legend.position = &#39;right&#39;)+
    labs(x=&#39;&#39;,y=&#39;&#39;,fill=&#39;Region&#39;)
ggsave(paste0(&quot;../../img/&quot;, tail(my.year,1),&quot;/Samples_EN.png&quot;), width=8, height=4, dpi=600, units=&quot;in&quot;)
## Warning: Removed 35 rows containing missing values or values outside the scale range (`geom_bar()`).</code></pre>
</div>
<div id="caa-plots" class="section level1 tabset" number="3">
<h1 class="tabset"><span class="header-section-number">3</span> CAA
plots</h1>
<div id="raw" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> RAW</h2>
<pre class="r"><code>caa$zero &lt;- caa$caan==0
ggplot(caa,aes(x=year,y=age))+
  geom_point(alpha=0.8,aes(size=caan,col=zero))+ 
  scale_size(range = c(1,12))+
  scale_y_continuous(breaks=min(caa$age):max(caa$age))+
  scale_color_manual(values=c(&#39;black&#39;,&#39;grey&#39;))+
  labs(x=&#39;Year&#39;,y=&#39;Age&#39;,size=&#39;Numbers&#39;,col=&#39;Zero&#39;)</code></pre>
<p><img src="2.2_caa_assessment_files/figure-html/caan_raw-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="spay" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> SPAY</h2>
<pre class="r"><code>d &lt;- reshape2::dcast(caa,age~year,value.var = &#39;caan&#39;)
if(length(unique(d$year)) &gt;1){
d &lt;- cbind(age=d[,1],spay(d[,-1]))
d &lt;- reshape2::melt(d,id.vars=&#39;age&#39;,variable.name=&#39;year&#39;,value.name=&#39;caan&#39;)
d$year &lt;- as.numeric(as.character(d$year))
ggplot(d,aes(x=year,y=age))+
  geom_point(alpha=0.8,aes(size=caan))+ 
  scale_size(range = c(1,12))+
  scale_y_continuous(breaks=min(caa$age):max(caa$age))
}</code></pre>
</div>
<div id="spay-prop" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> SPAY: prop</h2>
<pre class="r"><code>d &lt;- ddply(caa,c(&#39;year&#39;),transform,caan.prop=caan/sum(caan))
CAA&lt;- ggplot(d,aes(x=year,y=age))+
  geom_point(alpha=0.8,aes(size=caan.prop,col=zero))+ 
  scale_size(name=&quot;&quot;,range = c(1,12))+
  scale_y_continuous(breaks=min(caa$age):max(caa$age))+
  scale_color_manual(values=c(&#39;black&#39;,&#39;grey&#39;), guide=F)


CAA +  labs(x=&#39;Year&#39;,y=&#39;Age&#39;,size=&#39;Proportion&#39;,col=&#39;Zero&#39;)
## Warning: The `guide` argument in `scale_*()` cannot be `FALSE`. This was deprecated in ggplot2 3.3.4.
## ℹ Please use &quot;none&quot; instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<p><img src="2.2_caa_assessment_files/figure-html/caan_prop-1.png" width="960" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggsave(paste0(&quot;../../img/&quot;,tail(my.year,1),&quot;/CAA_EN.png&quot;), width=8, height=4, dpi=600, units=&quot;in&quot;)

CAA +  labs(x=&#39;Année&#39;,y=&#39;Âge&#39;,size=&#39;Proportion&#39;,col=&#39;Zero&#39;)</code></pre>
<p><img src="2.2_caa_assessment_files/figure-html/caan_prop-2.png" width="960" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggsave(paste0(&quot;../../img/&quot;,tail(my.year,1),&quot;/CAA_FR.png&quot;), width=8, height=4, dpi=600, units=&quot;in&quot;)

CAA +  labs(x=&#39;Année | Year&#39;,y=&#39;Âge | Age&#39;,size=&#39;Proportion&#39;,col=&#39;Zero&#39;)</code></pre>
<p><img src="2.2_caa_assessment_files/figure-html/caan_prop-3.png" width="960" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggsave(paste0(&quot;../../img/&quot;,tail(my.year,1),&quot;/CAA_BI.png&quot;), width=8, height=4, dpi=600, units=&quot;in&quot;)
</code></pre>
</div>
<div id="spya" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> SPYA</h2>
<pre class="r"><code>d &lt;- reshape2::dcast(caa,age~year,value.var = &#39;caan&#39;)
d &lt;- cbind(age=d[,1],spya(d[,-1]))
d &lt;- reshape2::melt(d,id.vars=&#39;age&#39;,variable.name=&#39;year&#39;,value.name=&#39;caan&#39;)
d$year &lt;- as.numeric(as.character(d$year))
ggplot(d,aes(x=year,y=age))+
  geom_point(alpha=0.8,aes(size=caan))+ 
  scale_size(range = c(1,12))+
  scale_y_continuous(breaks=min(caa$age):max(caa$age))</code></pre>
<p><img src="2.2_caa_assessment_files/figure-html/caan_spya-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="spya-prop" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> SPYA: prop</h2>
<pre class="r"><code>d &lt;- ddply(caa,c(&#39;age&#39;),transform,caan.prop=caan/sum(caan))
ggplot(d,aes(x=year,y=age))+
  geom_point(alpha=0.8,aes(size=caan.prop))+ 
  scale_size(range = c(1,12))+
  scale_y_continuous(breaks=min(caa$age):max(caa$age))</code></pre>
<p><img src="2.2_caa_assessment_files/figure-html/caan_spay_prop-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="waa" class="section level1 tabset" number="4">
<h1 class="tabset"><span class="header-section-number">4</span> WAA</h1>
<div id="linear-interpol" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> linear interpol</h2>
<pre class="r"><code>caa.old &lt;- expand.grid(year=1968:max(caa$year),age=unique(caa$age))
caa.inter &lt;- merge(caa.old,caa,all=TRUE)
caa.inter &lt;- caa.inter[order(caa.inter$age,caa.inter$year),]
par(mfrow=c(5,2))
caa.inter$waa.interpol &lt;- ddply(caa.inter,c(&#39;age&#39;),summarise,waa.interpol=interpol(year,waa,&quot;linear&quot;,from = 1968,to=max(caa.inter$year),title = age[1])[,6])[,2]
## Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in dplyr 1.1.0.
## ℹ Please use `reframe()` instead.
## ℹ When switching from `summarise()` to `reframe()`, remember that `reframe()` always returns an ungrouped data frame and adjust
##   accordingly.
## ℹ The deprecated feature was likely used in the plyr package.
##   Please report the issue at &lt;https://github.com/hadley/plyr/issues&gt;.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<p><img src="2.2_caa_assessment_files/figure-html/waa%20interpol-1.png" width="1344" style="display: block; margin: auto;" /></p>
<pre class="r"><code>caa.inter &lt;- caa.inter[order(caa.inter$year,caa.inter$age,decreasing = F),]

write.csv(caa.inter,paste0(&#39;../../csv/&#39;,tail(my.year,1),&#39;/caa_interpol.csv&#39;),row.names = FALSE)</code></pre>
</div>
<div id="plot" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Plot</h2>
<pre class="r"><code>p &lt;- ggplot(caa.inter,aes(x=year,y=waa.interpol,col=as.factor(age)))+
    geom_line()+
    scale_color_viridis_d()+
    scale_x_continuous(expand=c(0,0))+
    labs(y=&#39;Poids des captures | Catch weight (kg)&#39;,x=&#39;Année | Year&#39;)+
    theme(legend.position = &#39;none&#39;)
p</code></pre>
<p><img src="2.2_caa_assessment_files/figure-html/waa%20interpolplot-1.png" width="480" style="display: block; margin: auto;" /></p>
<pre class="r"><code>
p &lt;- p+labs(y=&#39;Poids dans le captures (kg)&#39;,x=&#39;Année&#39;)
ggsave(paste0(&#39;waac_FR.png&#39;),p,&#39;png&#39;,paste0(&#39;../../img/&#39;, tail(my.year,1)),width = 15,height = 8,units = &#39;cm&#39;)
</code></pre>
<p>Try model smoothing. Not used because if changes to WAA, waa*caa does
not equal total catch anymore. # Model predictions</p>
<pre class="r"><code>caa$waa.cv &lt;- 0.01 # need to calculate this!! this is absurdly small value so all predictions will match observed
caa[caa$caaw==0,&#39;caaw&#39;] &lt;- NA # should be correct in get.caa function
waa.fit &lt;- with(caa, armatrix.fit(year=caa$year,age=caa$age,x=caa$waa,cv=caa$waa.cv))
## Optimizing tape... Done
## Matching hessian patterns... Done
## outer mgc:  257.4846 
## outer mgc:  257.4846 
##   0:    -321.30787: -1.78897 -1.21537 -0.923805 -0.752832 -0.611077 -0.520402 -0.435237 -0.398028 -0.312742 -0.276643 -2.30259 -2.30259 -2.30259  0.00000  0.00000  0.00000  0.00000
## outer mgc:  78.54748 
## outer mgc:  43.61581 
## outer mgc:  30.15198 
## outer mgc:  30.61727 
## outer mgc:  30.35444 
## outer mgc:  30.24758 
## outer mgc:  29.80206 
## outer mgc:  29.5092 
## outer mgc:  29.00617 
## outer mgc:  28.60569 
##  10:    -372.35666: -1.79140 -1.21418 -0.933073 -0.753704 -0.623744 -0.523003 -0.446219 -0.408179 -0.329503 -0.295028 -2.43694 -2.51616 -2.10776 0.0268196 0.0505497 -0.0748816 -0.309604
## outer mgc:  28.12131 
## outer mgc:  27.60904 
## outer mgc:  27.41228 
## outer mgc:  26.83422 
## outer mgc:  28.09635 
## outer mgc:  30.28708 
## outer mgc:  25.07815 
## outer mgc:  29.63368 
## outer mgc:  30.0001 
## outer mgc:  31.00988 
##  20:    -383.56872: -1.79011 -1.22659 -0.928962 -0.759055 -0.629383 -0.525773 -0.444437 -0.421162 -0.325035 -0.301328 -2.54653 -2.66455 -2.15806 0.0532226 0.0952841 -0.111920 -0.549482
## outer mgc:  33.44414 
## outer mgc:  41.06955 
## outer mgc:  22.88546 
## outer mgc:  34.01845 
## outer mgc:  38.8253 
## outer mgc:  60.40643 
## outer mgc:  19.78801 
## outer mgc:  24.21902 
## outer mgc:  19.0277 
## outer mgc:  32.31277 
##  30:    -391.52427: -1.78751 -1.22495 -0.941418 -0.760745 -0.615805 -0.534694 -0.455039 -0.415184 -0.324584 -0.305986 -2.63952 -2.75924 -2.20276 0.0857500 0.141416 -0.164194 -0.794821
## outer mgc:  19.98947 
## outer mgc:  19.96826 
## outer mgc:  17.38563 
## outer mgc:  17.27109 
## outer mgc:  17.04512 
## outer mgc:  16.72883 
## outer mgc:  16.51769 
## outer mgc:  16.32133 
## outer mgc:  16.0671 
## outer mgc:  15.85204 
##  40:    -395.10998: -1.79275 -1.22212 -0.936961 -0.764314 -0.624692 -0.531861 -0.448756 -0.415869 -0.335878 -0.300127 -2.68190 -2.79827 -2.21881 0.104971 0.167002 -0.192609 -0.915669
## outer mgc:  15.64896 
## outer mgc:  15.4152 
## outer mgc:  15.17204 
## outer mgc:  14.98097 
## outer mgc:  14.74611 
## outer mgc:  14.53202 
## outer mgc:  14.32138 
## outer mgc:  14.10789 
## outer mgc:  13.87652 
## outer mgc:  13.69697 
##  50:    -397.43203: -1.79351 -1.22325 -0.936854 -0.763313 -0.624175 -0.532772 -0.450327 -0.416745 -0.337021 -0.299502 -2.71468 -2.81778 -2.23487 0.128251 0.195638 -0.223907 -1.02966
## outer mgc:  13.4477 
## outer mgc:  13.27709 
## outer mgc:  13.06424 
## outer mgc:  12.82831 
## outer mgc:  13.43505 
## outer mgc:  12.47955 
## outer mgc:  14.33146 
## outer mgc:  12.06065 
## outer mgc:  15.06096 
## outer mgc:  19.81659 
##  60:    -399.34801: -1.79209 -1.22179 -0.935268 -0.763718 -0.629392 -0.535742 -0.452928 -0.417530 -0.335817 -0.299588 -2.73999 -2.82548 -2.25028 0.160310 0.235325 -0.261648 -1.14272
## outer mgc:  11.55012 
## outer mgc:  25.68287 
## outer mgc:  11.29379 
## outer mgc:  18.62758 
## outer mgc:  10.87684 
## outer mgc:  10.772 
## outer mgc:  10.98076 
## outer mgc:  10.46658 
## outer mgc:  10.23678 
## outer mgc:  12.23232 
##  70:    -400.98843: -1.79494 -1.22117 -0.935139 -0.763494 -0.626850 -0.534980 -0.453427 -0.418925 -0.337794 -0.303669 -2.76039 -2.82933 -2.26334 0.197181 0.281744 -0.299422 -1.24773
## outer mgc:  10.06417 
## outer mgc:  13.68522 
## outer mgc:  9.528275 
## outer mgc:  13.30663 
## outer mgc:  10.97199 
## outer mgc:  11.55766 
## outer mgc:  8.897193 
## outer mgc:  9.076172 
## outer mgc:  12.26489 
## outer mgc:  8.693038 
##  80:    -402.43675: -1.79439 -1.22410 -0.934892 -0.767090 -0.626602 -0.538476 -0.452305 -0.419746 -0.337749 -0.303598 -2.77133 -2.82025 -2.27573 0.249495 0.349024 -0.343684 -1.34925
## outer mgc:  10.13384 
## outer mgc:  8.505045 
## outer mgc:  13.92546 
## outer mgc:  8.224623 
## outer mgc:  11.2506 
## outer mgc:  7.984575 
## outer mgc:  11.65197 
## outer mgc:  7.72094 
## outer mgc:  10.72276 
## outer mgc:  7.497871 
##  90:    -403.76094: -1.79623 -1.22539 -0.935656 -0.767619 -0.627676 -0.538176 -0.454374 -0.419781 -0.339745 -0.304263 -2.78414 -2.81477 -2.28891 0.309081 0.426281 -0.386611 -1.45245
## outer mgc:  11.14331 
## outer mgc:  24.55089 
## outer mgc:  38.13878 
## outer mgc:  40.34986 
## outer mgc:  39.48315 
## outer mgc:  33.7528 
## outer mgc:  21.12195 
## outer mgc:  17.85516 
## outer mgc:  7.212303 
## outer mgc:  6.81422 
## 100:    -406.68938: -1.79864 -1.22751 -0.939768 -0.770465 -0.631334 -0.543838 -0.457446 -0.425295 -0.344378 -0.309509 -2.77008 -2.73332 -2.31781 0.551456 0.736993 -0.519883 -1.69870
## outer mgc:  5.189169 
## outer mgc:  22.73946 
## outer mgc:  18.74359 
## outer mgc:  27.2488 
## outer mgc:  19.85661 
## outer mgc:  24.08017 
## outer mgc:  29.0818 
## outer mgc:  24.35664 
## outer mgc:  12.72772 
## outer mgc:  16.08336 
## 110:    -409.62166: -1.80870 -1.23520 -0.950568 -0.782202 -0.639521 -0.551640 -0.472744 -0.441509 -0.357767 -0.319774 -2.70123 -2.55319 -2.34647  1.08841  1.35017 -0.656496 -1.97838
## outer mgc:  19.85769 
## outer mgc:  24.23066 
## outer mgc:  29.98007 
## outer mgc:  22.11625 
## outer mgc:  19.15617 
## outer mgc:  22.49581 
## outer mgc:  20.89321 
## outer mgc:  17.66079 
## outer mgc:  16.30923 
## outer mgc:  8.226447 
## 120:    -411.44505: -1.81509 -1.24599 -0.958361 -0.789462 -0.650781 -0.561630 -0.477733 -0.445087 -0.364469 -0.332507 -2.55523 -2.39308 -2.35096  1.78334  1.84170 -0.702596 -2.33026
## outer mgc:  3.216078 
## outer mgc:  2.077148 
## outer mgc:  2.236205 
## outer mgc:  1.813787 
## outer mgc:  2.209755 
## outer mgc:  1.808727 
## outer mgc:  2.179226 
## outer mgc:  1.803311 
## outer mgc:  2.106568 
## outer mgc:  1.797657 
## 130:    -411.48593: -1.81581 -1.24625 -0.958646 -0.791186 -0.652471 -0.563836 -0.479774 -0.446120 -0.365677 -0.331049 -2.55438 -2.39642 -2.35106  1.78812  1.84427 -0.703072 -2.33665
## outer mgc:  2.027431 
## outer mgc:  1.791809 
## outer mgc:  1.954612 
## outer mgc:  1.7858 
## outer mgc:  1.893019 
## outer mgc:  1.779658 
## outer mgc:  1.84326 
## outer mgc:  1.773408 
## outer mgc:  1.804249 
## outer mgc:  1.767067 
## 140:    -411.50845: -1.81685 -1.24730 -0.959658 -0.792214 -0.653473 -0.564819 -0.480775 -0.447076 -0.366648 -0.332005 -2.55298 -2.39855 -2.35111  1.79454  1.84680 -0.703558 -2.34484
## outer mgc:  1.774377 
## outer mgc:  1.760651 
## outer mgc:  1.756907 
## outer mgc:  1.754174 
## outer mgc:  1.75039 
## outer mgc:  1.747647 
## outer mgc:  1.74383 
## outer mgc:  1.741078 
## outer mgc:  1.737234 
## outer mgc:  1.734475 
## 150:    -411.52996: -1.81772 -1.24818 -0.960511 -0.793077 -0.654313 -0.565657 -0.481604 -0.447891 -0.367461 -0.332810 -2.55172 -2.39967 -2.35119  1.80106  1.84875 -0.704086 -2.35363
## outer mgc:  1.730608 
## outer mgc:  1.727845 
## outer mgc:  1.723958 
## outer mgc:  1.721193 
## outer mgc:  1.717289 
## outer mgc:  1.714523 
## outer mgc:  1.720368 
## outer mgc:  1.707839 
## outer mgc:  1.72679 
## outer mgc:  1.701146 
## 160:    -411.55080: -1.81846 -1.24892 -0.961229 -0.793805 -0.655019 -0.566364 -0.482298 -0.448578 -0.368143 -0.333485 -2.55064 -2.40039 -2.35128  1.80740  1.85032 -0.704675 -2.36276
## outer mgc:  1.735096 
## outer mgc:  1.694446 
## outer mgc:  1.745157 
## outer mgc:  1.687742 
## outer mgc:  1.756868 
## outer mgc:  1.681039 
## outer mgc:  1.77014 
## outer mgc:  1.674339 
## outer mgc:  1.784892 
## outer mgc:  1.667645 
## 170:    -411.57110: -1.81908 -1.24955 -0.961839 -0.794426 -0.655619 -0.566968 -0.482887 -0.449161 -0.368721 -0.334057 -2.54977 -2.40108 -2.35138  1.81338  1.85161 -0.705337 -2.37207
## outer mgc:  1.801039 
## outer mgc:  1.660961 
## outer mgc:  1.81848 
## outer mgc:  1.654293 
## outer mgc:  1.837093 
## outer mgc:  1.647644 
## outer mgc:  1.856716 
## outer mgc:  1.641022 
## outer mgc:  1.859742 
## outer mgc:  1.634416 
## 180:    -411.59086: -1.81963 -1.25010 -0.962369 -0.794965 -0.656139 -0.567490 -0.483396 -0.449665 -0.369219 -0.334551 -2.54926 -2.40197 -2.35148  1.81879  1.85267 -0.706088 -2.38145
## outer mgc:  1.841211 
## outer mgc:  1.627801 
## outer mgc:  1.842266 
## outer mgc:  1.621188 
## outer mgc:  1.83132 
## outer mgc:  1.61457 
## outer mgc:  1.830468 
## outer mgc:  1.607955 
## outer mgc:  1.821858 
## outer mgc:  1.601337 
## 190:    -411.61007: -1.82010 -1.25057 -0.962834 -0.795431 -0.656595 -0.567944 -0.483843 -0.450103 -0.369654 -0.334981 -2.54886 -2.40283 -2.35159  1.82390  1.85354 -0.706876 -2.39096
## outer mgc:  1.819803 
## outer mgc:  1.594725 
## outer mgc:  1.812704 
## outer mgc:  1.588114 
## outer mgc:  1.809904 
## outer mgc:  1.581509 
## outer mgc:  1.803805 
## outer mgc:  1.57491 
## outer mgc:  1.800556 
## outer mgc:  1.568318 
## 200:    -411.62884: -1.82052 -1.25099 -0.963239 -0.795838 -0.656992 -0.568339 -0.484232 -0.450484 -0.370031 -0.335354 -2.54836 -2.40351 -2.35171  1.82894  1.85426 -0.707664 -2.40062
## outer mgc:  1.795136 
## outer mgc:  1.561734 
## outer mgc:  1.791626 
## outer mgc:  1.555159 
## outer mgc:  1.786682 
## outer mgc:  1.548594 
## outer mgc:  1.783031 
## outer mgc:  1.54204 
## outer mgc:  1.778427 
## outer mgc:  1.535497 
## 210:    -411.64719: -1.82089 -1.25136 -0.963595 -0.796195 -0.657340 -0.568684 -0.484571 -0.450816 -0.370361 -0.335678 -2.54776 -2.40406 -2.35184  1.83394  1.85487 -0.708455 -2.41040
## outer mgc:  1.77471 
## outer mgc:  1.528966 
## outer mgc:  1.770359 
## outer mgc:  1.522448 
## outer mgc:  1.766622 
## outer mgc:  1.515943 
## outer mgc:  1.762462 
## outer mgc:  1.509452 
## outer mgc:  1.758733 
## outer mgc:  1.502975 
## 220:    -411.66514: -1.82121 -1.25168 -0.963909 -0.796509 -0.657646 -0.568988 -0.484869 -0.451106 -0.370648 -0.335960 -2.54705 -2.40452 -2.35198  1.83892  1.85540 -0.709247 -2.42028
## outer mgc:  1.754722 
## outer mgc:  1.496514 
## outer mgc:  1.751018 
## outer mgc:  1.490068 
## outer mgc:  1.747127 
## outer mgc:  1.483637 
## outer mgc:  1.743456 
## outer mgc:  1.477223 
## outer mgc:  1.739663 
## outer mgc:  1.470825 
## 230:    -411.68272: -1.82150 -1.25197 -0.964188 -0.796787 -0.657916 -0.569255 -0.485130 -0.451361 -0.370900 -0.336207 -2.54624 -2.40492 -2.35212  1.84388  1.85586 -0.710044 -2.43022
## outer mgc:  1.73603 
## outer mgc:  1.464444 
## outer mgc:  1.732317 
## outer mgc:  1.458081 
## outer mgc:  1.728723 
## outer mgc:  1.451734 
## outer mgc:  1.725079 
## outer mgc:  1.445406 
## outer mgc:  1.721524 
## outer mgc:  1.439096 
## 240:    -411.69994: -1.82176 -1.25223 -0.964436 -0.797035 -0.658157 -0.569493 -0.485362 -0.451585 -0.371122 -0.336424 -2.54533 -2.40527 -2.35227  1.84884  1.85625 -0.710845 -2.44022
## outer mgc:  1.717938 
## outer mgc:  1.432804 
## outer mgc:  1.71442 
## outer mgc:  1.42653 
## outer mgc:  1.710884 
## outer mgc:  1.420275 
## outer mgc:  1.7074 
## outer mgc:  1.414039 
## outer mgc:  1.703908 
## outer mgc:  1.407822 
## 250:    -411.71681: -1.82200 -1.25246 -0.964660 -0.797257 -0.658371 -0.569705 -0.485568 -0.451784 -0.371318 -0.336615 -2.54434 -2.40559 -2.35242  1.85381  1.85660 -0.711652 -2.45026
## outer mgc:  1.700456 
## outer mgc:  1.401625 
## outer mgc:  1.697002 
## outer mgc:  1.395446 
## outer mgc:  1.693579 
## outer mgc:  1.389288 
## outer mgc:  1.690159 
## outer mgc:  1.383149 
## outer mgc:  1.686762 
## outer mgc:  1.377029 
## 260:    -411.73334: -1.82221 -1.25267 -0.964862 -0.797459 -0.658565 -0.569895 -0.485752 -0.451961 -0.371493 -0.336786 -2.54325 -2.40588 -2.35257  1.85879  1.85690 -0.712464 -2.46033
## outer mgc:  1.68337 
## outer mgc:  1.37093 
## outer mgc:  1.679998 
## outer mgc:  1.364851 
## outer mgc:  1.676631 
## outer mgc:  1.358791 
## outer mgc:  1.67328 
## outer mgc:  1.352752 
## outer mgc:  1.669935 
## outer mgc:  1.346733 
## 270:    -411.74955: -1.82241 -1.25287 -0.965047 -0.797642 -0.658741 -0.570068 -0.485919 -0.452121 -0.371651 -0.336939 -2.54209 -2.40615 -2.35272  1.86379  1.85715 -0.713284 -2.47044
## outer mgc:  1.666602 
## outer mgc:  1.340735 
## outer mgc:  1.663278 
## outer mgc:  1.334756 
## outer mgc:  1.659961 
## outer mgc:  1.328798 
## outer mgc:  1.656653 
## outer mgc:  1.322861 
## outer mgc:  1.65335 
## outer mgc:  1.316944 
## 280:    -411.76543: -1.82259 -1.25305 -0.965218 -0.797811 -0.658903 -0.570226 -0.486071 -0.452265 -0.371793 -0.337077 -2.54086 -2.40642 -2.35287  1.86882  1.85737 -0.714110 -2.48056
## outer mgc:  1.650057 
## outer mgc:  1.311047 
## outer mgc:  1.646766 
## outer mgc:  1.305171 
## outer mgc:  1.643486 
## outer mgc:  1.299315 
## outer mgc:  1.640205 
## outer mgc:  1.29348 
## outer mgc:  1.636936 
## outer mgc:  1.287666 
## 290:    -411.78100: -1.82276 -1.25322 -0.965377 -0.797968 -0.659053 -0.570372 -0.486210 -0.452398 -0.371923 -0.337202 -2.53957 -2.40667 -2.35303  1.87388  1.85755 -0.714942 -2.49070
## outer mgc:  1.633663 
## outer mgc:  1.281872 
## outer mgc:  1.630404 
## outer mgc:  1.276098 
## outer mgc:  1.627137 
## outer mgc:  1.270345 
## outer mgc:  1.623887 
## outer mgc:  1.264613 
## outer mgc:  1.620624 
## outer mgc:  1.258901 
## 300:    -411.79627: -1.82292 -1.25338 -0.965527 -0.798115 -0.659193 -0.570508 -0.486340 -0.452520 -0.372043 -0.337318 -2.53822 -2.40692 -2.35319  1.87897  1.85770 -0.715780 -2.50086
## outer mgc:  1.617383 
## outer mgc:  1.253209 
## outer mgc:  1.614121 
## outer mgc:  1.247538 
## outer mgc:  1.610889 
## outer mgc:  1.241887 
## outer mgc:  1.607626 
## outer mgc:  1.236257 
## outer mgc:  1.604405 
## outer mgc:  1.230647 
## 310:    -411.81123: -1.82308 -1.25353 -0.965669 -0.798254 -0.659325 -0.570635 -0.486462 -0.452634 -0.372155 -0.337426 -2.53682 -2.40717 -2.35334  1.88410  1.85780 -0.716623 -2.51102
## outer mgc:  1.601136 
## outer mgc:  1.225057 
## outer mgc:  1.597929 
## outer mgc:  1.219488 
## outer mgc:  1.594646 
## outer mgc:  1.213939 
## outer mgc:  1.591535 
## outer mgc:  1.20841 
## outer mgc:  1.588407 
## outer mgc:  1.202901 
## 320:    -411.82591: -1.82323 -1.25367 -0.965805 -0.798387 -0.659450 -0.570757 -0.486576 -0.452742 -0.372260 -0.337527 -2.53537 -2.40743 -2.35350  1.88927  1.85788 -0.717469 -2.52120
## outer mgc:  1.585421 
## outer mgc:  1.197412 
## outer mgc:  1.582254 
## outer mgc:  1.191943 
## outer mgc:  1.579325 
## outer mgc:  1.186494 
## outer mgc:  1.576086 
## outer mgc:  1.181066 
## outer mgc:  1.573257 
## outer mgc:  1.175657 
## 330:    -411.84029: -1.82337 -1.25381 -0.965936 -0.798515 -0.659571 -0.570873 -0.486686 -0.452844 -0.372360 -0.337623 -2.53388 -2.40768 -2.35365  1.89448  1.85792 -0.718319 -2.53138
## outer mgc:  1.569883 
## outer mgc:  1.170267 
## outer mgc:  1.567241 
## outer mgc:  1.164898 
## outer mgc:  1.56361 
## outer mgc:  1.159548 
## outer mgc:  1.561323 
## outer mgc:  1.154218 
## outer mgc:  1.557194 
## outer mgc:  1.148907 
## 340:    -411.85439: -1.82351 -1.25395 -0.966064 -0.798639 -0.659688 -0.570985 -0.486791 -0.452942 -0.372456 -0.337714 -2.53236 -2.40794 -2.35381  1.89974  1.85792 -0.719170 -2.54157
## outer mgc:  1.555608 
## outer mgc:  1.143616 
## outer mgc:  1.550484 
## outer mgc:  1.138344 
## outer mgc:  1.55032 
## outer mgc:  1.133092 
## outer mgc:  1.543161 
## outer mgc:  1.127858 
## outer mgc:  1.545969 
## outer mgc:  1.122646 
## 350:    -411.86821: -1.82365 -1.25408 -0.966189 -0.798760 -0.659801 -0.571093 -0.486894 -0.453037 -0.372548 -0.337802 -2.53079 -2.40821 -2.35396  1.90504  1.85790 -0.720021 -2.55177
## outer mgc:  1.534535 
## outer mgc:  1.117449 
## outer mgc:  1.543752 
## outer mgc:  1.112277 
## outer mgc:  1.523149 
## outer mgc:  1.107115 
## outer mgc:  1.546687 
## outer mgc:  1.101986 
## outer mgc:  1.506156 
## outer mgc:  1.096857 
## 360:    -411.88177: -1.82379 -1.25422 -0.966308 -0.798877 -0.659914 -0.571202 -0.486993 -0.453124 -0.372635 -0.337892 -2.52919 -2.40848 -2.35411  1.91038  1.85783 -0.720871 -2.56197
## outer mgc:  1.563191 
## outer mgc:  1.091777 
## outer mgc:  1.479801 
## outer mgc:  1.086678 
## outer mgc:  1.621135 
## outer mgc:  1.081669 
## outer mgc:  1.559943 
## outer mgc:  1.076605 
## outer mgc:  1.685477 
## outer mgc:  1.071703 
## 370:    -411.89498: -1.82391 -1.25434 -0.966451 -0.798997 -0.660011 -0.571278 -0.487095 -0.453238 -0.372740 -0.337945 -2.52752 -2.40872 -2.35426  1.91578  1.85772 -0.721706 -2.57215
## outer mgc:  1.526019 
## outer mgc:  1.066687 
## outer mgc:  1.433019 
## outer mgc:  1.061881 
## outer mgc:  1.188504 
## outer mgc:  1.056993 
## outer mgc:  1.218989 
## outer mgc:  1.052223 
## outer mgc:  1.126223 
## outer mgc:  1.047434 
## 380:    -411.90782: -1.82402 -1.25443 -0.966511 -0.799058 -0.660098 -0.571362 -0.487149 -0.453254 -0.372767 -0.338014 -2.52468 -2.40814 -2.35444  1.92218  1.85745 -0.722363 -2.58220
## outer mgc:  1.221524 
## outer mgc:  1.042706 
## outer mgc:  1.206868 
## outer mgc:  1.03797 
## outer mgc:  1.298338 
## outer mgc:  1.033265 
## outer mgc:  1.30609 
## outer mgc:  1.028545 
## outer mgc:  1.414983 
## outer mgc:  1.023849 
## 390:    -411.92064: -1.82414 -1.25455 -0.966621 -0.799169 -0.660179 -0.571442 -0.487221 -0.453332 -0.372836 -0.338065 -2.52216 -2.40824 -2.35460  1.92887  1.85740 -0.723137 -2.59214
## outer mgc:  1.411746 
## outer mgc:  1.019128 
## outer mgc:  1.571352 
## outer mgc:  1.014461 
## outer mgc:  1.523903 
## outer mgc:  1.009746 
## outer mgc:  1.650541 
## outer mgc:  1.005161 
## outer mgc:  1.430711 
## outer mgc:  1.000487 
## 400:    -411.93319: -1.82431 -1.25469 -0.966740 -0.799277 -0.660323 -0.571576 -0.487332 -0.453397 -0.372911 -0.338185 -2.52041 -2.40879 -2.35473  1.93498  1.85736 -0.723998 -2.60209
## outer mgc:  1.254816 
## outer mgc:  0.9960209 
## outer mgc:  1.030626 
## outer mgc:  3.339244 
## outer mgc:  6.181561 
## outer mgc:  5.158298 
## outer mgc:  5.126809 
## outer mgc:  7.082658 
## outer mgc:  5.76794 
## outer mgc:  3.667584 
## 410:    -412.26666: -1.83764 -1.26776 -0.979015 -0.811688 -0.672097 -0.582587 -0.498908 -0.464455 -0.383078 -0.348688 -2.36382 -2.43634 -2.35949  2.37162  1.82034 -0.737991 -3.03138
## outer mgc:  5.213512 
## outer mgc:  3.997854 
## outer mgc:  4.711485 
## outer mgc:  2.636493 
## outer mgc:  2.168954 
## outer mgc:  3.807548 
## outer mgc:  2.08426 
## outer mgc:  2.197384 
## outer mgc:  1.240973 
## outer mgc:  1.089652 
## 420:    -412.34978: -1.83360 -1.26344 -0.975004 -0.807076 -0.667821 -0.578638 -0.493724 -0.459441 -0.378717 -0.343663 -2.38011 -2.43183 -2.36261  2.33332  1.81588 -0.768574 -3.62460
## outer mgc:  0.7118503 
## outer mgc:  0.2175869 
## outer mgc:  0.1437636 
## outer mgc:  0.02165403 
## outer mgc:  0.01367531 
## outer mgc:  0.004560542 
## outer mgc:  0.001047349 
## outer mgc:  0.001047349 
## outer mgc:  4.647185 
## outer mgc:  4.647167 
## outer mgc:  5.920292 
## outer mgc:  5.920834 
## outer mgc:  5.983713 
## outer mgc:  5.983774 
## outer mgc:  6.022809 
## outer mgc:  6.022493 
## outer mgc:  6.039604 
## outer mgc:  6.038628 
## outer mgc:  6.033198 
## outer mgc:  6.033235 
## outer mgc:  5.983288 
## outer mgc:  5.982502 
## outer mgc:  5.726555 
## outer mgc:  5.726003 
## outer mgc:  5.028404 
## outer mgc:  5.029032 
## outer mgc:  3.399983 
## outer mgc:  3.402078 
## outer mgc:  0.02120116 
## outer mgc:  0.02136864 
## outer mgc:  0.04540055 
## outer mgc:  0.0453944 
## outer mgc:  0.7635936 
## outer mgc:  0.7650213 
## outer mgc:  0.009428847 
## outer mgc:  0.009281684 
## outer mgc:  0.01669445 
## outer mgc:  0.01667447 
## outer mgc:  0.06677368 
## outer mgc:  0.06654052 
## outer mgc:  0.001166635 
## outer mgc:  0.001759698 
## outer mgc:  1
waa.fit
## armatrix model: log likelihood is 412.3503 Convergence OK

caa$waa.cv &lt;- with(caa,waa.sd/waa) # need to calculate this!! this is absurdly small value so all predictions will match observed
waa.fit &lt;- armatrix.fit(year=caa$year,age=caa$age,x=caa$waa,cv=caa$waa.cv)
## Warning in armatrix.fit(year = caa$year, age = caa$age, x = caa$waa, cv = caa$waa.cv): cvs equal to 0/NA replaced by value of historic 95%
## quantile
## Optimizing tape... Done
## Matching hessian patterns... Done
## outer mgc:  79.75497 
## outer mgc:  79.75497 
##   0:    -290.53140: -1.78897 -1.21537 -0.923805 -0.752832 -0.611077 -0.520402 -0.435237 -0.398028 -0.312742 -0.276643 -2.30259 -2.30259 -2.30259  0.00000  0.00000  0.00000  0.00000
## outer mgc:  94.50286 
## outer mgc:  95.85476 
## outer mgc:  48.10141 
## outer mgc:  50.79932 
## outer mgc:  59.29115 
## outer mgc:  54.98574 
## outer mgc:  91.04363 
## outer mgc:  39.24601 
## outer mgc:  41.90726 
## outer mgc:  20.20839 
##  10:    -347.01398: -1.75057 -1.20437 -0.932866 -0.762638 -0.618220 -0.531470 -0.448139 -0.425413 -0.324110 -0.322424 -2.69000 -2.75176 -3.28586 0.0839771 0.103521 0.122134 0.0704663
## outer mgc:  24.10455 
## outer mgc:  31.58606 
## outer mgc:  31.61788 
## outer mgc:  37.0099 
## outer mgc:  25.76774 
## outer mgc:  29.09989 
## outer mgc:  41.67664 
## outer mgc:  31.07232 
## outer mgc:  39.37357 
## outer mgc:  7.913703 
##  20:    -353.58441: -1.75799 -1.21247 -0.923362 -0.754043 -0.618159 -0.530785 -0.448023 -0.425779 -0.322040 -0.314515 -2.86926 -2.92280 -3.53333 0.151589 0.178366 0.155922 0.0879443
## outer mgc:  24.45359 
## outer mgc:  7.630942 
## outer mgc:  14.90918 
## outer mgc:  9.269809 
## outer mgc:  12.01261 
## outer mgc:  8.703751 
## outer mgc:  11.52789 
## outer mgc:  8.5723 
## outer mgc:  10.7435 
## outer mgc:  8.018487 
##  30:    -355.02896: -1.75995 -1.20538 -0.926254 -0.756886 -0.620093 -0.532078 -0.448671 -0.425304 -0.319740 -0.311053 -2.92525 -2.97187 -3.61483 0.184699 0.214738 0.167964 0.0938512
## outer mgc:  9.910486 
## outer mgc:  7.407985 
## outer mgc:  7.981493 
## outer mgc:  7.9493 
## outer mgc:  12.35506 
## outer mgc:  8.711349 
## outer mgc:  7.516297 
## outer mgc:  9.023947 
## outer mgc:  8.963596 
## outer mgc:  6.558943 
##  40:    -356.15020: -1.75985 -1.20654 -0.924778 -0.755777 -0.620592 -0.533138 -0.448400 -0.426149 -0.320017 -0.310558 -2.96540 -3.00058 -3.70288 0.234876 0.269897 0.182569 0.101151
## outer mgc:  6.667571 
## outer mgc:  8.017284 
## outer mgc:  7.691376 
## outer mgc:  6.351384 
## outer mgc:  10.14103 
## outer mgc:  7.2105 
## outer mgc:  6.18506 
## outer mgc:  4.672539 
## outer mgc:  6.550622 
## outer mgc:  6.286336 
##  50:    -357.05071: -1.75838 -1.20629 -0.926277 -0.757351 -0.621168 -0.532226 -0.448931 -0.426841 -0.320778 -0.311847 -2.98896 -3.01168 -3.78358 0.301042 0.342643 0.197219 0.108372
## outer mgc:  7.25575 
## outer mgc:  5.377268 
## outer mgc:  4.462686 
## outer mgc:  8.805828 
## outer mgc:  5.56986 
## outer mgc:  6.900039 
## outer mgc:  8.321043 
## outer mgc:  4.187381 
## outer mgc:  8.323628 
## outer mgc:  5.003158 
##  60:    -357.80975: -1.76084 -1.20547 -0.926251 -0.757387 -0.621267 -0.533265 -0.449612 -0.426812 -0.320918 -0.312243 -3.00212 -3.01292 -3.85115 0.378448 0.426670 0.210285 0.114461
## outer mgc:  7.85265 
## outer mgc:  3.764271 
## outer mgc:  7.353087 
## outer mgc:  3.690235 
## outer mgc:  8.184662 
## outer mgc:  3.562 
## outer mgc:  6.262998 
## outer mgc:  5.100978 
## outer mgc:  10.64537 
## outer mgc:  3.799693 
##  70:    -358.49503: -1.76228 -1.20689 -0.926653 -0.758166 -0.621455 -0.533709 -0.450558 -0.425298 -0.323582 -0.313198 -3.01257 -3.01227 -3.91322 0.461405 0.514603 0.222274 0.119667
## outer mgc:  8.424777 
## outer mgc:  3.278017 
## outer mgc:  9.437796 
## outer mgc:  3.181383 
## outer mgc:  8.339988 
## outer mgc:  3.131132 
## outer mgc:  10.78391 
## outer mgc:  2.987927 
## outer mgc:  7.53821 
## outer mgc:  32.4403 
##  80:    -359.93875: -1.76886 -1.20554 -0.923617 -0.757918 -0.626504 -0.531351 -0.442909 -0.438743 -0.331359 -0.311017 -3.05009 -3.00916 -4.14857 0.747838 0.811486 0.265407 0.137705
## outer mgc:  30.12041 
## outer mgc:  35.70881 
## outer mgc:  17.51016 
## outer mgc:  8.653386 
## outer mgc:  7.667935 
## outer mgc:  5.211039 
## outer mgc:  3.172862 
## outer mgc:  8.354558 
## outer mgc:  15.65404 
## outer mgc:  10.56081 
##  90:    -362.30722: -1.77994 -1.22782 -0.946881 -0.784003 -0.643836 -0.553393 -0.472600 -0.450763 -0.345220 -0.335085 -2.95068 -2.87711 -4.48110  1.31319  1.32045 0.329214 0.161631
## outer mgc:  14.95878 
## outer mgc:  11.34079 
## outer mgc:  9.793546 
## outer mgc:  11.36592 
## outer mgc:  20.14058 
## outer mgc:  14.10539 
## outer mgc:  18.36702 
## outer mgc:  3.666567 
## outer mgc:  3.164509 
## outer mgc:  8.437432 
## 100:    -363.14766: -1.77868 -1.21973 -0.940786 -0.776538 -0.642573 -0.549760 -0.466814 -0.444035 -0.338409 -0.334590 -2.82488 -2.78683 -4.68336  1.86171  1.64048 0.374868 0.170156
## outer mgc:  5.438359 
## outer mgc:  6.641844 
## outer mgc:  8.620668 
## outer mgc:  8.423574 
## outer mgc:  5.396598 
## outer mgc:  5.625878 
## outer mgc:  5.770143 
## outer mgc:  6.490311 
## outer mgc:  4.506088 
## outer mgc:  1.580578 
## 110:    -363.53848: -1.79173 -1.23718 -0.958986 -0.789668 -0.653513 -0.564875 -0.481248 -0.457940 -0.350969 -0.345865 -2.61957 -2.73123 -5.17397  2.52963  1.81053 0.514852 0.183269
## outer mgc:  1.924876 
## outer mgc:  2.365591 
## outer mgc:  6.053437 
## outer mgc:  3.146462 
## outer mgc:  2.667692 
## outer mgc:  2.018581 
## outer mgc:  1.988542 
## outer mgc:  1.373725 
## outer mgc:  1.082338 
## outer mgc:  0.605117 
## 120:    -363.65717: -1.78831 -1.23415 -0.954849 -0.786801 -0.650307 -0.561514 -0.477857 -0.454479 -0.347389 -0.341889 -2.65757 -2.75102 -6.94953  2.40513  1.78276  1.15828 0.241228
## outer mgc:  0.1620699 
## outer mgc:  0.07466185 
## outer mgc:  0.0813838 
## outer mgc:  0.04424545 
## outer mgc:  0.02983728 
## outer mgc:  0.01962735 
## outer mgc:  0.005376494 
## outer mgc:  0.001945951 
## outer mgc:  0.0008511207 
## outer mgc:  0.0002619373 
## 130:    -363.65976: -1.78811 -1.23443 -0.954838 -0.786649 -0.650476 -0.561610 -0.478023 -0.454779 -0.347548 -0.342073 -2.66069 -2.74964 -9.90828  2.40228  1.78628  2.23982 0.343635
## outer mgc:  0.0001598255 
## outer mgc:  6.545257e-05 
## outer mgc:  1.45607e-05 
## outer mgc:  1.719606e-05 
## outer mgc:  5.004197e-06 
## outer mgc:  1.320923e-06 
## outer mgc:  1.320923e-06 
## outer mgc:  0.8443513 
## outer mgc:  0.8443505 
## outer mgc:  1.134535 
## outer mgc:  1.134534 
## outer mgc:  1.784856 
## outer mgc:  1.784856 
## outer mgc:  2.104618 
## outer mgc:  2.10462 
## outer mgc:  2.51959 
## outer mgc:  2.51959 
## outer mgc:  2.506879 
## outer mgc:  2.506881 
## outer mgc:  2.815157 
## outer mgc:  2.815157 
## outer mgc:  3.042462 
## outer mgc:  3.042461 
## outer mgc:  3.398569 
## outer mgc:  3.398566 
## outer mgc:  2.157792 
## outer mgc:  2.157794 
## outer mgc:  0.01376697 
## outer mgc:  0.01374282 
## outer mgc:  0.02152449 
## outer mgc:  0.02149998 
## outer mgc:  1.321893e-06 
## outer mgc:  1.319954e-06 
## outer mgc:  0.01094868 
## outer mgc:  0.01095318 
## outer mgc:  0.007311773 
## outer mgc:  0.007312993 
## outer mgc:  1.320938e-06 
## outer mgc:  1.320907e-06 
## outer mgc:  1.320739e-06 
## outer mgc:  1.321106e-06 
## outer mgc:  1
waa.fit
## armatrix model: log likelihood is 363.6598 Convergence OK</code></pre>
</div>
<div id="predicted" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Predicted</h2>
<pre class="r"><code>armatrix.predobs(waa.fit,scale=&#39;free&#39;,ncol=3)
## Warning: Removed 20 rows containing missing values or values outside the scale range (`geom_point()`).</code></pre>
<p><img src="2.2_caa_assessment_files/figure-html/waa_predobs-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="predicted-1" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Predicted</h2>
<pre class="r"><code>armatrix.pred(waa.fit,scale=&#39;free&#39;,ncol=3)</code></pre>
<p><img src="2.2_caa_assessment_files/figure-html/waa_pred-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="resid-bubble" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Resid bubble</h2>
<pre class="r"><code>armatrix.res(waa.fit)
## Warning: Removed 20 rows containing missing values or values outside the scale range (`geom_point()`).</code></pre>
<p><img src="2.2_caa_assessment_files/figure-html/waa_res-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="resid-dot" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Resid dot</h2>
<pre class="r"><code>armatrix.res2(waa.fit)
## Warning: Removed 20 rows containing non-finite outside the scale range (`stat_smooth()`).
## Warning: Removed 20 rows containing missing values or values outside the scale range (`geom_text()`).
## Warning: Removed 20 rows containing non-finite outside the scale range (`stat_smooth()`).
## Warning: Removed 20 rows containing missing values or values outside the scale range (`geom_point()`).
## Removed 20 rows containing missing values or values outside the scale range (`geom_point()`).
## Removed 20 rows containing missing values or values outside the scale range (`geom_point()`).</code></pre>
<p><img src="2.2_caa_assessment_files/figure-html/waa_res2-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="effects" class="section level2" number="4.7">
<h2><span class="header-section-number">4.7</span> effects</h2>
<pre class="r"><code>armatrix.effects(waa.fit) # empty plot because of ggplotGrob function within (used to align plots)</code></pre>
<p><img src="2.2_caa_assessment_files/figure-html/waa_effects-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="cvs" class="section level2" number="4.8">
<h2><span class="header-section-number">4.8</span> cvs</h2>
<pre class="r"><code>armatrix.cvs(waa.fit,scale=&#39;free&#39;,ncol=3)
## Warning: Removed 13 rows containing missing values or values outside the scale range (`geom_line()`).</code></pre>
<p><img src="2.2_caa_assessment_files/figure-html/waa_cv-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
